!function(){document.documentElement.classList.add("js");const t=window.WORKS||[],e=window.WORK_CATEGORIES||[],n=window.WORK_YEARS||[{key:"2026",label:"2026 / 2026"},{key:"2025",label:"2025 / 2025"},{key:"2024",label:"2024 / 2024"},{key:"2023",label:"2023 / 2023"},{key:"2022",label:"2022 / 2022"},{key:"2021",label:"2021 / 2021"}];let a=e.find(t=>"All"===t.key)?"All":e[0]&&e[0].key||"All";const s=(t,e=document)=>e.querySelector(t),i=(t,e=document)=>Array.from(e.querySelectorAll(t));function o(t){const e=t.role_zh||t.role||"",n=t.role_en||"";return e&&n?`${e} / ${n}`:e||n||""}function l(t){return t?t.replace(/\.(png|jpe?g)$/i,".webp"):""}function r(t){const e=t.cover_size||"contain",n=t.cover||"",a=t.cover_webp||l(n),s=function(t){const e=(t||"").split(".").pop().toLowerCase();return"jpg"===e||"jpeg"===e?"image/jpeg":"png"===e?"image/png":"webp"===e?"image/webp":""}(n)||"image/png",i=`linear-gradient(120deg, rgba(15, 23, 42, 0.45), rgba(15, 23, 42, 0.2)), url('${n}')`,r=n?` style="background-image: ${i}; background-image: ${a&&a!==n?`linear-gradient(120deg, rgba(15, 23, 42, 0.45), rgba(15, 23, 42, 0.2)), image-set(url('${a}') type('image/webp'), url('${n}') type('${s}'))`:i}; background-size: ${e}; background-position: center; background-repeat: no-repeat;"`:"";return`\n      <article class="work-card" data-slug="${t.slug}">\n        <div class="work-cover"${r}>\n          <div class="cover-shift" data-parallax></div>\n        </div>\n        <div class="work-info">\n          <h3>\n            <span class="block">${t.title_zh}</span>\n            ${t.title_en?`<span class="block text-sm" style="color:#64748b;font-weight:400;">${t.title_en}</span>`:""}\n          </h3>\n          <p>${o(t)}</p>\n          <div class="platform-row">\n            <span class="platform-pill">${t.platform}</span>\n          </div>\n        </div>\n      </article>\n    `}function c(){const e=s("[data-grid='works']");if(!e)return;let o=t.slice();"All"!==a&&(o=o.filter(t=>t.category===a));const l=new Set;o=o.filter(t=>!(!t||!t.slug)&&(!l.has(t.slug)&&(l.add(t.slug),!0))),o.sort((t,e)=>{const n=Number(t.year)||0,a=Number(e.year)||0;if(n!==a)return a-n;const s=(t.title_zh||t.title_en||"").toString(),i=(e.title_zh||e.title_en||"").toString();return s.localeCompare(i,"zh-Hans-CN")});const c=Number(e.dataset.limit||"0");c&&(o=o.slice(0,c)),"true"===e.dataset.grouped?function(t,e){const a=n.map(t=>String(t.key)).filter(t=>t&&"All"!==t),s=new Map;e.forEach(t=>{const e=String(t.year||"");s.has(e)||s.set(e,[]),s.get(e).push(t)});const o=a.map(t=>{const e=s.get(t)||[];return`\n        <div class="year-group">\n          <div class="year-title">${t} <span>Year / 年份</span></div>\n          ${e.length?`<div class="grid grid-4">${e.map(r).join("")}</div>`:'<div class="year-empty">暂无作品 / No works yet</div>'}\n        </div>\n      `});t.innerHTML=o.join(""),i(".work-card",t).forEach(t=>{t.addEventListener("click",()=>d(t.dataset.slug))})}(e,o):function(t,e){t.innerHTML=e.map(r).join(""),i(".work-card",t).forEach(t=>{t.addEventListener("click",()=>d(t.dataset.slug))})}(e,o)}function d(e){const n=s(".modal");if(!n)return;const a=t.find(t=>t.slug===e);if(!a)return;const i=s("[data-modal-title]"),r=s("[data-modal-role]"),c=s("[data-modal-year]"),d=s("[data-modal-desc]"),p=s("[data-modal-link]"),u=s("[data-modal-detail-link]"),f=s("[data-modal-iframe]"),m=s("[data-modal-placeholder]"),v=s("[data-modal-cover]"),h=s("[data-modal-cover-webp]"),y=v?v.closest("picture"):null,b=s("[data-modal-credits]"),w=s("[data-modal-tools]"),k=s("[data-modal-process]"),$=s("[data-modal-stills]");if(i.textContent=`${a.title_zh} / ${a.title_en}`,r.textContent=o(a),c.textContent=a.year,d.textContent=function(t){const e=t.one_line_zh||t.one_line||"",n=t.one_line_en||"";return e&&n?`${e} ${n}`:e||n||""}(a),p&&(p.href=a.link||"#",p.textContent=a.link?"打开原链接 / Open Link":"链接待补充 / Link pending"),u&&(u.href=`work.html?slug=${encodeURIComponent(a.slug)}`),b){const t=a.credits&&a.credits.length?a.credits:["待补充 / To be updated"];b.innerHTML=t.map(t=>`<li>${t}</li>`).join("")}if(w){const t=a.tools&&a.tools.length?a.tools:["Premiere Pro","DaVinci Resolve"];w.innerHTML=t.map(t=>`<span class="chip">${t}</span>`).join("")}if(k){const t=a.process&&a.process.length?a.process:["前期策划 / Pre‑production","现场执行 / On‑set","后期剪辑 / Post"];k.innerHTML=t.map(t=>`\n          <div class="skill-card">\n            <strong>${t.split("/")[0].trim()}</strong>\n            <p style="margin-top: 6px; color: #6b7280;">${t}</p>\n          </div>\n        `).join("")}if($){$.classList.toggle("stills-large","bookstore"===a.slug);const t=a.stills&&a.stills.length?a.stills:[];$.innerHTML=t.length?t.map((t,e)=>{const n=l(t);return`<div class="still-card"><picture>${n&&n!==t?`<source srcset="${n}" type="image/webp" />`:""}<img alt="still ${e+1}" src="${t}" loading="lazy" decoding="async" /></picture></div>`}).join(""):'<div class="still-card">画面待补充 / Stills pending</div>'}if(a.embed)f.style.display="block",f.src=a.embed,v&&(v.style.display="none"),y&&(y.style.display="none"),m&&(m.style.display="none");else{if(f.style.display="none",v){const t=a.cover||a.stills&&a.stills[0]||"",e=a.cover_webp||l(t);t?(v.src=t,v.alt=`${a.title_zh} / ${a.title_en}`,v.style.display="block",h&&e&&e!==t&&h.setAttribute("srcset",e),y&&(y.style.display="block")):(v.style.display="none",y&&(y.style.display="none"))}m&&(m.style.display="none")}n.classList.add("active"),g("overview")}function p(){const t=s(".modal");if(!t)return;const e=s("[data-modal-iframe]");e&&(e.src="");const n=s("[data-modal-cover]");n&&(n.src="");const a=s("[data-modal-cover-webp]");a&&a.setAttribute("srcset",""),t.classList.remove("active")}function g(t){i(".tab-btn").forEach(e=>e.classList.toggle("active",e.dataset.tab===t)),i("[data-panel]").forEach(e=>e.classList.toggle("active",e.dataset.panel===t))}!function(){const t=s(".hero");if(!t)return;const e=i(".hero-layer");t.addEventListener("mousemove",n=>{const a=t.getBoundingClientRect(),s=(n.clientX-a.left)/a.width-.5,i=(n.clientY-a.top)/a.height-.5;e.forEach((t,e)=>{const n=8*(e+1);t.style.transform=`translate3d(${s*n}px, ${i*n}px, 0)`})})}(),function(){const t=i(".nav-links a[href^='#']");if(!t.length)return;const e=new Map;if(t.forEach(t=>{const n=t.getAttribute("href").slice(1),a=s(`#${n}`);a&&e.set(a,t)}),!e.size)return;const n=new IntersectionObserver(n=>{n.forEach(n=>{if(n.isIntersecting){t.forEach(t=>t.classList.remove("active"));const a=e.get(n.target);a&&a.classList.add("active")}})},{threshold:.35});e.forEach((t,e)=>n.observe(e))}(),function(){const t=i("[data-parallax]");if(!t.length)return;let e=!1;const n=()=>{e=!1;const n=window.innerHeight||1;t.forEach(t=>{const e=t.parentElement;if(!e)return;const a=e.getBoundingClientRect().top/n-.5,s=Math.max(-12,Math.min(12,18*a));t.style.transform=`translateY(${s}px)`})};n(),window.addEventListener("scroll",()=>{e||(window.requestAnimationFrame(n),e=!0)},{passive:!0}),window.addEventListener("resize",n)}(),function(){const t=s(".filters");if(!t)return;let e=!1;const n=()=>{e=!1;const n=t.getBoundingClientRect().top;t.classList.toggle("is-stuck",n<=69)};n(),window.addEventListener("scroll",()=>{e||(window.requestAnimationFrame(n),e=!0)},{passive:!0}),window.addEventListener("resize",n)}(),function(){const t=i(".reveal");if(!t.length)return;const e=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&(t.target.classList.add("visible"),e.unobserve(t.target))})},{threshold:.2});t.forEach(t=>e.observe(t))}(),s("[data-grid='works']")&&c(),function(){const t=s("[data-filters]");t&&function(t){t.innerHTML=e.map(t=>`<button class="filter-btn ${t.key===a?"active":""}" data-key="${t.key}">${t.label}</button>`).join(""),i(".filter-btn",t).forEach(e=>{e.addEventListener("click",()=>{i(".filter-btn",t).forEach(t=>t.classList.remove("active")),e.classList.add("active"),a=e.dataset.key,c()})})}(t)}(),function(){const t=s(".modal");t&&(t.addEventListener("click",t=>{t.target.classList.contains("modal")&&p()}),i("[data-modal-close]").forEach(t=>t.addEventListener("click",p)),window.addEventListener("keydown",t=>{"Escape"===t.key&&p()}),i(".tab-btn").forEach(t=>{t.addEventListener("click",()=>g(t.dataset.tab))}))}()}();